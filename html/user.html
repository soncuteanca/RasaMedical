<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <title>User Profile - Medical Assistant</title>
    <style>
        body {
            background-color: #CFC3BD;
            font-family: Arial, sans-serif;
            margin: 0;
            color: #2C2C2C;
        }
        header {
            background-color: #5E1F28;
            color: #F0EDEA;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 2;
            box-sizing: border-box;
        }
        .title {
            font-size: 22px;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: bold;
            white-space: nowrap;
            flex-shrink: 0;
        }
        .button-container {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        .button {
            min-width: 90px;
            border-radius: 10px;
            font-size: 15px;
            padding: 7px 18px;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s, color 0.2s, box-shadow 0.2s;
            margin: 0;
            text-align: center;
            font-weight: bold;
            border: 2px solid #5E1F28;
            box-sizing: border-box;
        }
        .button-chat {
            background: #B3A09A;
            color: #5E1F28;
            border: 2px solid #5E1F28;
        }
        .button-chat:hover {
            background: #4A1F24;
            color: #F0EDEA;
        }
        .button-login, .button-create, .button-logout {
            background-color: #4A1F24;
            color: #F0EDEA;
            border: 2px solid #4A1F24;
        }
        .button-login:hover, .button-create:hover, .button-logout:hover {
            background-color: #B3A09A;
            color: #5E1F28;
            border-color: #B3A09A;
        }
        @media (max-width: 600px) {
            .title {
                font-size: 16px;
            }
            .button {
                min-width: 70px;
                font-size: 13px;
                padding: 5px 0;
            }
            header {
                padding: 6px 6px;
            }
        }
        .container {
            max-width: 900px;
            margin: 100px auto 40px auto;
            background: #B3A09A;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 32px 40px 40px 40px;
        }
        h2 {
            color: #5E1F28;
            margin-top: 0;
        }
        .profile-section {
            border-bottom: 1px solid #B3A09A;
            padding-bottom: 18px;
            margin-bottom: 24px;
        }
        .profile-info {
            display: flex;
            align-items: center;
            gap: 32px;
        }
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            background: #B3A09A;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            color: #5E1F28;
            font-weight: bold;
            border: 2px solid #5E1F28;
        }
        .profile-details {
            flex: 1;
        }
        .section {
            margin-bottom: 32px;
        }
        .section-title {
            font-size: 20px;
            color: #5E1F28;
            margin-bottom: 10px;
        }
        .record-list, .appointment-list {
            list-style: none;
            padding: 0;
        }
        .record-list li, .appointment-list li {
            background: #CFC3BD;
            margin-bottom: 10px;
            padding: 14px 18px;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03);
        }
        .empty-msg {
            color: #888;
            font-style: italic;
        }
        .back-link {
            display: inline-block;
            margin-bottom: 18px;
            color: #5E1F28;
            text-decoration: none;
            font-weight: bold;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .button-delete {
            background-color: #5E1F28;
            color: #F0EDEA;
            border: 2px solid #5E1F28;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: background 0.2s, color 0.2s, border 0.2s;
        }
        .button-delete:hover {
            background-color: #4A1F24;
            color: #F0EDEA;
            border-color: #4A1F24;
        }
        #deleteModal .modal-content, #successModal .modal-content {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            border-top: 4px solid #5E1F28;
            padding: 30px 40px;
        }
        #deleteModal h3, #successModal h3 {
            color: #5E1F28;
            margin-top: 0;
        }
        #deleteModal .modal-icon, #successModal .modal-icon {
            font-size: 48px;
            color: #5E1F28;
            margin-bottom: 15px;
        }
        #deleteModal .modal-btn, #successModal .modal-btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            background: #5E1F28;
            color: #F0EDEA;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 0 5px;
            transition: background 0.2s;
        }
        #deleteModal .modal-btn:hover, #successModal .modal-btn:hover {
            background: #4A1F24;
        }
        #deleteModal .modal-btn.danger {
            background: #fff;
            color: #5E1F28;
            border: 2px solid #5E1F28;
            transition: background 0.2s, color 0.2s, border 0.2s;
        }
        #deleteModal .modal-btn.danger:hover {
            background: #5E1F28;
            color: #F0EDEA;
            border-color: #5E1F28;
        }
    </style>
</head>
<body>
<header>
    <h1 class="title">Medical Assistant</h1>
    <div class="button-container">
        <a href="index.html" class="button button-chat">Chat Now!</a>
        <a href="login.html" class="button button-login" id="loginBtn">Login</a>
        <a href="create_user.html" class="button button-create" id="createAccountBtn">Create Account</a>
        <button class="button button-logout" id="logoutBtn" style="display:none;">Logout</button>
    </div>
</header>
<div class="container" style="margin-top: 90px;">
    <a href="home_page.html" class="back-link">&larr; Back to Home</a>
    <div class="profile-section">
        <div class="profile-info">
            <div class="profile-avatar" id="profileAvatar">U</div>
            <div class="profile-details">
                <h2 id="profileName">User Name</h2>
                <div id="profileEmail">user@email.com</div>
            </div>
        </div>
    </div>
    <div class="section">
        <div class="section-title">Appointments</div>
        <ul class="appointment-list" id="appointmentList">
            <li class="empty-msg">Loading appointments...</li>
        </ul>
    </div>
    <div class="section">
        <div class="section-title">Medical Records</div>
        <ul class="record-list" id="recordList">
            <li class="empty-msg">Loading medical records...</li>
        </ul>
    </div>
    <div class="section">
        <button id="deleteAccountBtn" class="button button-delete">Delete Account</button>
    </div>
</div>

<!-- Delete Account Confirmation Modal -->
<div id="deleteModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div class="modal-content">
        <div class="modal-icon">⚠️</div>
        <h3>Warning: Delete Account</h3>
        <p style="font-size:16px; color:#333; margin-bottom:10px; font-weight:bold;">This action is permanent and cannot be undone!</p>
        <p style="font-size:16px; color:#666; margin-bottom:20px;">All your data will be permanently deleted from our system.</p>
        <div style="display:flex; gap:10px; justify-content:center;">
            <button onclick="closeDeleteModal()" class="modal-btn">Cancel</button>
            <button onclick="confirmDeleteAccount()" class="modal-btn danger">Yes, Delete My Account</button>
        </div>
    </div>
</div>

<!-- Success Message Modal -->
<div id="successModal" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
    <div class="modal-content">
        <div class="modal-icon">✓</div>
        <h3>Account Deleted</h3>
        <p style="font-size:16px; color:#333; margin-bottom:20px;">Your account has been successfully deleted. You will be redirected to the home page.</p>
        <button onclick="redirectToHome()" class="modal-btn">OK</button>
    </div>
</div>

<script>
// Show Logout if logged in, else show Create Account. Show user name instead of Login if logged in.
window.addEventListener('DOMContentLoaded', function() {
    const token = localStorage.getItem('userToken');
    const user = localStorage.getItem('user');
    const createBtn = document.getElementById('createAccountBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const loginBtn = document.getElementById('loginBtn');
    if (token && user) {
        createBtn.style.display = 'none';
        logoutBtn.style.display = 'inline-block';
        loginBtn.style.display = 'none';
    } else {
        createBtn.style.display = 'inline-block';
        logoutBtn.style.display = 'none';
        loginBtn.style.display = 'inline-block';
    }
    logoutBtn && logoutBtn.addEventListener('click', function() {
        localStorage.removeItem('userToken');
        localStorage.removeItem('user');
        location.href = 'home_page.html';
    });
});
// Load user info from localStorage
const user = localStorage.getItem('user');
if (!user) {
    window.location.href = 'login.html';
}
const userObj = JSON.parse(user);
document.getElementById('profileName').textContent = userObj.name || 'User';
document.getElementById('profileEmail').textContent = userObj.email || '';
document.getElementById('profileAvatar').textContent = userObj.name ? userObj.name.charAt(0).toUpperCase() : 'U';

// Fetch appointments
fetch(`http://localhost:5000/api/appointments?user_id=${userObj.id}`)
    .then(res => res.json())
    .then(data => {
        const list = document.getElementById('appointmentList');
        list.innerHTML = '';
        if (Array.isArray(data) && data.length > 0) {
            data.forEach(app => {
                const li = document.createElement('li');
                li.textContent = `Date: ${app.appointment_date} | Reason: ${app.reason || 'N/A'} | Status: ${app.status || 'scheduled'}`;
                list.appendChild(li);
            });
        } else {
            list.innerHTML = '<li class="empty-msg">No appointments found.</li>';
        }
    })
    .catch(() => {
        document.getElementById('appointmentList').innerHTML = '<li class="empty-msg">Failed to load appointments.</li>';
    });

// Fetch medical records
fetch(`http://localhost:5000/api/records?user_id=${userObj.id}`)
    .then(res => res.json())
    .then(data => {
        const list = document.getElementById('recordList');
        list.innerHTML = '';
        if (Array.isArray(data) && data.length > 0) {
            data.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = `Diagnosis: ${rec.diagnosis} | Treatment: ${rec.treatment}`;
                list.appendChild(li);
            });
        } else {
            list.innerHTML = '<li class="empty-msg">No medical records found.</li>';
        }
    })
    .catch(() => {
        document.getElementById('recordList').innerHTML = '<li class="empty-msg">Failed to load medical records.</li>';
    });

// Add delete account functionality
document.getElementById('deleteAccountBtn').addEventListener('click', function() {
    document.getElementById('deleteModal').style.display = 'flex';
});

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

async function confirmDeleteAccount() {
    const user = JSON.parse(localStorage.getItem('user'));
    if (!user || !user.id) {
        alert('Error: User information not found');
        return;
    }

    try {
        const response = await fetch(`http://localhost:5000/api/users/${user.id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            // Clear local storage
            localStorage.removeItem('userToken');
            localStorage.removeItem('user');
            // Show success message
            document.getElementById('deleteModal').style.display = 'none';
            document.getElementById('successModal').style.display = 'flex';
        } else {
            const result = await response.json();
            alert('Error deleting account: ' + result.error);
        }
    } catch (error) {
        alert('Error deleting account: ' + error.message);
    }
}

function redirectToHome() {
    window.location.href = 'home_page.html';
}
</script>
</body>
</html> 